<!DOCTYPE html>
<html><head><title>DL8</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=1024">
<LINK REL="stylesheet" TYPE="text/css" HREF="s_common.css">
<LINK REL="stylesheet" TYPE="text/css" HREF="s_trend.css">
<script type="text/javascript" src="button_enable.js"></script>
<script type="text/javascript" src="trend_page.js"></script>
<script type="text/javascript" src="dl_header.js"></script>
<script type="text/javascript" src="trend_p4.js"></script>
<script type="text/javascript" src="s_button_event.js"></script>
<script type="text/javascript" src="s_xml_cmd.js" ></script>
<!--[if lt IE 9]>
<script type="text/javascript" src="excanvas.js"></script>
<![endif]-->
<script type="text/javascript" src="trend_draw.js"></script>
<script type="text/javascript">

var page = "4";
var now_page = "p" + page;
var now_type = "P" + page;

var trend_html = "s_trend_" + now_page + ".html";
var trend_js   = "trend_" + now_page + ".js";
var trend_json = "trend_" + now_page + ".json";
var ref_key    = "REF_" + now_page;

var touch = 0;
var auto_updating = 0;
var right_offset = 0;
var browser = "IE";

window.onpageshow = function() {
	document.screen_select.s_sel.value = "TREND";
	document.type_select.t_sel.value = now_type;
}

function update_local()
{
	file_load_ie( "./" + trend_html );
	file_load_ie( "./trend_page.js" );
	file_load_ie( "./" + trend_js );
	update();
}

function update_timeout()
{
	auto_updating = 0;
}

function update_auto()
{
	update_header_time();
	trend_draw(1);
	trend_modify(trend_samples-1);
	auto_updating = 0;
}

function update_check()
{
	var pos = document.getElementById("draw_area").scrollWidth - document.getElementById("draw_area").scrollLeft - window_x;
	if( (scroll_ok == 0) && (pos <= right_offset) ){
		return 1;
	}
	return 0;
}

function update_refresh()
{
	if( auto_updating != 0 ) return;

	var pos = document.getElementById("draw_area").scrollWidth - document.getElementById("draw_area").scrollLeft - window_x;

	if( browser == "Chrome" ){
		if( window.devicePixelRatio == 1 )	right_offset = 0;
		else								right_offset = 3;
	}

	if( (scroll_ok == 0) && (pos <= right_offset) ){

		if( touch != 0 ){
			touch = 0;
			return;
		}
		auto_updating = 1;
		update_trend_data( trend_json, now_page, update_check, update_auto, update_timeout, 0 );
	}
}

window.onload = function() {
	var userAgent = window.navigator.userAgent.toLowerCase();
	if( userAgent.indexOf("safari")  != -1 )		browser = "Safari";
	if( userAgent.indexOf("chrome")  != -1 )		browser = "Chrome";
	if( userAgent.indexOf("firefox") != -1 )		browser = "Firefox";
	if( userAgent.indexOf("opera")   != -1 )		browser = "Opera";

	trend_init( now_page );
//	page_button();
	update_header();

//	auto_updating = 1;
//	update_trend_data( trend_json, now_page, null, update_auto, update_timeout, 1 );
	trend_draw(1);

	if( button_disable == 0 ){
		var ref = getCookie( ref_key );
		if( ref == "" ){
			ref = "0";
		}
		if( ref != 0 ){
			setInterval("update_refresh()",ref*1000);
		}
	}

}

function refresh_rate()
{
	if( button_disable != 0 ) return;

	var ref = getCookie( ref_key );
	if( ref == "" ){
		ref = "0";
	}
	var rtn = window.prompt( "auto refresh rate 0-999[s]", ref );
	if( rtn != null ){
		if( rtn.match(/[^0-9]/) ){
			alert("input error");
			return;
		}

		var num = Number(rtn);
		if( (num < 0) || (num > 999) ){
			alert("input error");
			return;
		}

		setCookieX( ref_key, rtn );
		update_local();
	}
}
</script>
</head>

<body style="background-color: #000000;">

<!-- HEADER -->
<div>
	<table class="header">
	  <tbody><tr>
    	<td class="name1" id="name1"></td>
    	<td class="name2" id="name2"></td>
    	<td class="fig1"></td>
      </tr></tbody>
    </table>
</div>

<!-- SCREEN SELCT -->
<form class="screen_select" name="screen_select">
  <select class="s_sel" name="s_sel" onChange="jump(ref_key);">
	<option value="MENU">Menu</option>
	<option value="DATA">Data</option>
	<option value="TREND" selected>Trend</option>
	<option value="EVENT">Event</option>
	<option value="AUTOREF">-AutoRef-</option>
  </select>
</form>

<!-- PAGE SELCT -->
<form class="type_select" name="type_select">
  <select class="t_sel" name="t_sel" onChange="jump_page();">
	<option value="P1">P1</option>
	<option value="P2">P2</option>
	<option value="P3">P3</option>
	<option value="P4" selected>P4</option>
	<option value="P5">P5</option>
	<option value="P6">P6</option>
	<option value="P7">P7</option>
	<option value="P8">P8</option>
  </select>
</form>

<!-- UPDATE -->
<input class ="button_update" type="button" value="Update" onclick="update_local();">

<!-- TIME,NAME3,DATE -->
<div>
	<table class="time_name3_date">
	  <tbody><tr>
    	<td class="back18"></td>
    	<td class="time" id="time"></td>
    	<td class="name3" id="name3"></td>
    	<td class="date" id="date"></td>
    	<td class="back22"></td>
      </tr></tbody>
    </table>
</div>



<!-- TREND GROUP -->
<div>
<table class="trend_group">
	  <tbody><tr>
	    <td class="trend_dummy" id="trend_dummy"></td>
	    <td class="trend_pname" id="trend_pname"></td>
	    <td class="trend_time" id="trend_time"></td>
      </tr></tbody>
    </table>
</div>

<!-- GRAPH -->
<div class="graph_base">
	<table class="graph" id="graph">
	  <tbody>
	  <tr>
    	<td class="scale_dummy"></td>
    	<td id="graph_area" class="graph_area" rowspan="10" onselectstart="return false;" unselectable="on"></td>
    	<td class="pen_dummy"></td>
    	<td class="num_dummy"></td>
      </tr>

	  <tr>
    	<td id="scale_100" class="scale_100" rowspan="2"></td>
    	<td id="mark_p1" class="pen_mark"></td>
    	<td id="num_p1" class="num", rowspan="2"></td></tr>
    	<tr><td id="no_p1" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_p2" class="scale_blank" rowspan="2"></td>
    	<td id="mark_p2" class="pen_mark"></td>
    	<td id="num_p2" class="num", rowspan="2"></td></tr>
    	<tr><td id="no_p2" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_p3" class="scale_blank" rowspan="2"></td>
    	<td id="mark_p3" class="pen_mark"></td>
    	<td id="num_p3" class="num", rowspan="2"></td></tr>
    	<tr><td id="no_p3" class="pen_no"></td>
      </tr>

	  <tr>
    	<td id="scale_0" class="scale_0" rowspan="2"></td>
    	<td id="mark_p4" class="pen_mark"></td>
    	<td id="num_p4" class="num", rowspan="2"></td></tr>
    	<tr><td id="no_p4" class="pen_no"></td>
      </tr>

	  <tr>
    	<td class="scale_dummy"></td>
    	<td class="pen_dummy"></td>
    	<td class="num_dummy"></td>
      </tr>
      </tbody>
    </table>
</div>

<div id="draw_area" class="draw_area" onselectstart="return false;" unselectable="on">
	<canvas id="draw_area_canvas" class="draw_area_canvas"></canvas>
</div>
<div class="num_p1x" id="num_p1x"></div>
<div class="num_p2x" id="num_p2x"></div>
<div class="num_p3x" id="num_p3x"></div>
<div class="num_p4x" id="num_p4x"></div>

<!--[if IE]>
<div class="scroll_area" id="scroll_area" onselectstart="return false;" unselectable="on"></div>
<![endif]-->

<!-- DUMMY -->
<!--
<div class="bottom_dummy"></div>
-->

</body></html>

<script type="text/javascript">
var scroll_ok = 0;
var now_scroll = 0;

document.getElementById("draw_area").onscroll = function() {
	var pos = document.getElementById("draw_area").scrollWidth - document.getElementById("draw_area").scrollLeft - window_x;
	if( pos < 0 ){
//		document.getElementById("draw_area").scrollLeft -= pos;
//		return;
		pos = 0;
	}

	if( browser == "Chrome" ){
		if( window.devicePixelRatio == 1 )	right_offset = 0;
		else								right_offset = 3;
	}

	if( pos <= right_offset ) pos = 0;

	trend_modify(trend_samples-1-pos);
}
document.getElementById("draw_area_canvas").onmousedown = function(event){
	if( scroll_ok == 0 ){
		var e = (event) || window.event;
		now_scroll = e.clientX;
		scroll_ok = 1;
	}
}
document.getElementById("draw_area_canvas").onmousemove = function(event){
	if( scroll_ok == 1 ){
		var e = (event) || window.event;
		var pos = e.clientX;
		document.getElementById("draw_area").scrollLeft += ( now_scroll - pos );
		now_scroll = pos;
	}
}
document.getElementById("draw_area_canvas").onmouseout = function(){
	scroll_ok = 0;
}
document.onmouseup = function(){
	scroll_ok = 0;
}



document.getElementById("draw_area_canvas").ontouchstart = function(){
	var e = event.touches[0];
	now_scroll = e.clientX;
	touch = 1;
}
document.getElementById("draw_area_canvas").ontouchmove = function(){
	var e = event.touches[0];
	var pos = e.clientX;
	
	var left = document.getElementById("draw_area").scrollLeft;
	var move = now_scroll - pos;
	if( (left > 0) && (left < (scale_x - window_x)) ){
//		document.getElementById("draw_area").scrollLeft += move;
	}
	
	now_scroll = pos;
	touch = 1;
}


</script>

<!--[if IE]>
<script type="text/javascript">
document.getElementById("scroll_area").onmousedown = function(event){
	if( scroll_ok == 0 ){
		e = (event) || window.event;
		now_scroll = e.clientX;
		scroll_ok = 1;
	}
}
document.getElementById("scroll_area").onmousemove = function(event){
	if( scroll_ok == 1 ){
		e = (event) || window.event;
		pos = e.clientX;
		document.getElementById("draw_area").scrollLeft += ( now_scroll - pos );
		now_scroll = pos;
	}
}
document.getElementById("scroll_area").onmouseout = function(){
	scroll_ok = 0;
}
</script>
<![endif]-->

